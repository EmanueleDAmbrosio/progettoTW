<html>
<head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EDFilms</title>

    <link rel="icon" href="Icona_Scheda.png" sizes="32x32">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <link rel="stylesheet" href="style.css">

</head>
<body>
    <nav class="navbar navbar-expand-lg" style="background-color: #33006E;">

        <div class="container-fluid" style="background-color: #33006E;">
            <a class="navbar-brand" href="#"><img src="Logo.png" alt="Bootstrap" width="120" height="90"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarScroll">
                <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;">

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="Home.html" style="color: white;"><h5>Home</h5></a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="nuovo.html" style="color: white;"><h5>Film</h5></a>
                    </li>
                </ul>

                <form class="d-flex" role="search" onsubmit="event.preventDefault(); SEARCH()" method="POST">
                  <input class="form-control me-2" type="search" placeholder="Cerca..." aria-label="Search" name="search_query" id="nome">
                  <button class="btn btn-outline-success" type="submit" style="color:#FFFFFF">Ricerca</button>
              </form>

            </div>
        </div>
    </nav>
    <div class="modal-overlay">
    <div class="modal-content">
      <div id="innerDiv"> <!-- Verify that this element contains the content you want to modify -->
        <!-- Content that will be modified -->
      </div>
    </div>
  </div>
    <div id="filmsContainer" class="cont">
        <div class="container">
             <!-- Qui verranno aggiunti dinamicamente i dati dei film -->
        </div>
    </div>

    <script>

        function getFilmLibrary() {
            fetch('http://127.0.0.1/api/films', {
                method: 'GET',
                withCredentials: true,
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(responseJson => {
                if (responseJson.films && responseJson.films.length > 0) {
                    let filmLibrary = responseJson.films;
                    let filmsContainer = document.getElementById('filmsContainer');

                    filmLibrary.forEach(film => {
                        let filmDiv = document.createElement('div');
                        filmDiv.classList.add('animatedDiv');
                        // Modifica la classe "blue" per ogni tipo di film se necessario
                        const randomClass = getRandomClass(); // Ottieni una classe casuale
                        filmDiv.classList.add(randomClass); // Aggiungi la classe casuale al div del film

                        // Ottieni il nome del film limitato a 11 caratteri
                        const truncatedName = film.NOME_FILM.length > 11 ? `${film.NOME_FILM.slice(0, 11)}..` : film.NOME_FILM;

                        // Assegna il nome del film limitato all'elemento h1
                        filmDiv.innerHTML = `
                            <img src="uploads/${film.NOME_FILM}.jpg" alt="${film.NOME_FILM}" style="width: 100%; height: 70%;" />
                            <h1>${truncatedName}</h1>
                            <ul class="a">
                                <li>Nome: ${film.NOME_FILM}</li>
                                <li>Descrizione: ${film.DESCRIZIONE}</li>
                                <li>ANNO:${film.ANNO}</li>
                            </ul>
                        `;
                        filmsContainer.appendChild(filmDiv);
                    });
                } else {
                    console.log('Nessun film trovato.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        window.onload = function() {
            getFilmLibrary();
            setTimeout(function() {
                animateDivsToCenter(); // Move the divs to the center with animation
            }, 100); // Delay the animation by 100 milliseconds after the page loads
        };
        function getRandomClass() {
            const classes = ['blue', 'red', 'green', 'yellow']; // Elenco delle classi disponibili
            const randomIndex = Math.floor(Math.random() * classes.length); // Genera un indice casuale
            return classes[randomIndex]; // Restituisce una classe casuale dall'elenco
        }

        function animateDivsToCenter() {
            // Select the container and all animated divs
            var container = document.querySelector('.container');
            var divs = document.querySelectorAll('.animatedDiv');

            // Initialize variables for calculations
            var containerWidth = container.offsetWidth;
            var totalWidth = 0;
            var currentLineHeight = 45;
            var currentLineWidth = 0;
            var lineHeight = 0;
            var marginLeft = 10; // Space between divs

            // Loop through each div to position them in the container
            divs.forEach(function(div) {
                var divWidth = div.offsetWidth;
                var divHeight = div.offsetHeight;

                // If the div exceeds the container's width, move to the next line
                if (currentLineWidth + divWidth > containerWidth) {
                currentLineHeight += lineHeight + marginLeft;
                currentLineWidth = 0;
                lineHeight = 0;
                }

                // Set the position of the div
                div.style.top = currentLineHeight + 'px';
                div.style.left = currentLineWidth + 'px';

                // Update values for the next div placement
                currentLineWidth += divWidth + marginLeft;
                totalWidth = Math.max(totalWidth, currentLineWidth);
                lineHeight = Math.max(lineHeight, divHeight);
            });
        
            // Set the container's width to accommodate all positioned divs
            container.style.width = totalWidth + 'px';
        }
            document.addEventListener("DOMContentLoaded", function() {
            //Get modal overlay and inner div elements
            const modalOverlay = document.querySelector('.modal-overlay');
            const innerDiv = document.getElementById('innerDiv');
            
            // Initialize variables
            let insideInnerDiv = false;
            let videoElement = null; // Initialize videoElement
            
            // Event listeners for mouse entering and leaving innerDiv
            innerDiv.addEventListener('mouseover', () => {
                insideInnerDiv = true;
            });

            innerDiv.addEventListener('mouseleave', () => {
                insideInnerDiv = false;
                modalOverlay.style.display = 'none';
                if (videoElement) {
                videoElement.pause();
                videoElement.currentTime = 0;
                }
            });

            // Retrieve all elements with the class 'animatedDiv'
            const divs = document.querySelectorAll('.animatedDiv');

            // Loop through each div
            divs.forEach((div) => {
                let timeout;

                // Event listener for click on each div
                div.addEventListener('click', () => {
                // Extract necessary elements and attributes from the clicked div
                const imgSrc = div.querySelector('img').getAttribute('src');
                const videoSrc = imgSrc.replace(/\.(jpg|jpeg)$/i, '.mp4');
                const imgElement = div.querySelector('img');
                const h1Element = div.querySelector('h1');
                const h1Text = h1Element.textContent;
                const ulElement = div.querySelector('ul');
                const liElements = ulElement.querySelectorAll('li');
                
                // Create video element and related elements
                videoElement = document.createElement('video');
                videoElement.setAttribute('width', '700');
                videoElement.setAttribute('height', '400');
                videoElement.setAttribute('controls', 'true');

                const sourceElement = document.createElement('source');
                sourceElement.setAttribute('src', videoSrc);
                sourceElement.setAttribute('type', 'video/mp4');

                videoElement.appendChild(sourceElement);

                const textContainer = document.createElement('div');
                const h1TextElement = document.createElement('h1');
                const ulTextElement = document.createElement('ul');
                
                h1TextElement.textContent = h1Text;
                liElements.forEach(li => {
                    const liText = document.createElement('li');
                    liText.textContent = li.textContent;
                    ulTextElement.appendChild(liText);
                });

                textContainer.appendChild(h1TextElement);
                textContainer.appendChild(ulTextElement);
                
                // Update innerDiv with video and text content
                innerDiv.innerHTML = '';
                innerDiv.appendChild(videoElement);
                innerDiv.appendChild(textContainer);

                // Style innerDiv and display modalOverlay
                innerDiv.style.position = 'fixed';
                innerDiv.style.top = '50%';
                innerDiv.style.left = '50%';
                innerDiv.style.transform = 'translate(-50%, -50%)';
                modalOverlay.style.display = 'flex';
                });

                // Event listener for mouseover on each div with a delay
                div.addEventListener('mouseover', () => {
                timeout = setTimeout(() => {
                    // Extract necessary elements and attributes from the hovered div
                    const imgSrc = div.querySelector('img').getAttribute('src');
                    const videoSrc = imgSrc.replace(/\.(jpg|jpeg)$/i, '.mp4');

                    const imgElement = div.querySelector('img');
                    const h1Element = div.querySelector('h1');
                    const h1Text = h1Element.textContent;
                    const ulElement = div.querySelector('ul');
                    const liElements = ulElement.querySelectorAll('li');
                    
                    // Create video element and related elements
                    videoElement = document.createElement('video');
                    videoElement.setAttribute('width', '700');
                    videoElement.setAttribute('height', '400');
                    videoElement.setAttribute('controls', 'true');

                    const sourceElement = document.createElement('source');
                    sourceElement.setAttribute('src', videoSrc);
                    sourceElement.setAttribute('type', 'video/mp4');

                    videoElement.appendChild(sourceElement);

                    const textContainer = document.createElement('div');
                    const h1TextElement = document.createElement('h1');
                    const ulTextElement = document.createElement('ul');
                    
                    h1TextElement.textContent = h1Text;
                    liElements.forEach(li => {
                    const liText = document.createElement('li');
                    liText.textContent = li.textContent;
                    ulTextElement.appendChild(liText);
                    });

                    textContainer.appendChild(h1TextElement);
                    textContainer.appendChild(ulTextElement);

                    // Update innerDiv with video and text content
                    innerDiv.innerHTML = '';
                    innerDiv.appendChild(videoElement);
                    innerDiv.appendChild(textContainer);

                    // Style innerDiv and display modalOverlay
                    innerDiv.style.position = 'fixed';
                    innerDiv.style.top = '50%';
                    innerDiv.style.left = '50%';
                    innerDiv.style.transform = 'translate(-50%, -50%)';
                    modalOverlay.style.display = 'flex';
                }, 2000); // 2-second timeout
                });

                // Event listener for mouse leaving the modal overlay
                modalOverlay.addEventListener('mouseleave', () => {
                if (!insideInnerDiv) {
                    modalOverlay.style.display = 'none';
                    if (videoElement) {
                    videoElement.pause();
                    videoElement.currentTime = 0;
                    }
                }
                });

                // Event listeners for innerDiv mouse entering and leaving
                innerDiv.addEventListener('mouseenter', () => {
                insideInnerDiv = true;
                });

                innerDiv.addEventListener('mouseleave', () => {
                insideInnerDiv = false;
                });
            });
        });
            function SEARCH() {
            let nome = document.getElementById('nome').value;
            let url = `http://127.0.0.1/api/search?nome=${encodeURIComponent(nome)}`;

            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json(); // Attendiamo la risposta come JSON
            })
            .then(responseJson => {
                if (responseJson.film) {
                    // Serializza l'oggetto film in una stringa JSON e passalo nell'URL
                    let filmData = encodeURIComponent(JSON.stringify(responseJson.film));

                    // Reindirizzamento alla pagina search.html con i dati nell'URL
                    window.location.href = `search.html?nome=${filmData}`;
                } else {
                    console.log(responseJson.error); // Messaggio se non è stato trovato alcun film
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
</html>
